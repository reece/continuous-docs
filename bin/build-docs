#!/bin/sh

virtualenv .venv
source .venv/bin/activate

rm -rf master/ || true
git clone -b master . master
#repo_url=$(git config --get remote.origin.url)
#git clone $repo_url master/

pip install -U -r master/doc/requirements.txt
pip install -U master/

version=$(python master/setup.py --version)
git rm -rf ./$version/ || true
sphinx-build -b html master/doc/source/ ./$version/
ln -sf $version latest

git add ./$version/ latest
git commit -m "regenerated documentation $(date +%F) for $version"
